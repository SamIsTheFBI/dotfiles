#!/bin/sh

wall_dir=~/Wallpapers
dwm_dir=~/.local/src/dwm
dmenu_dir=~/.local/src/dmenu
st_dir=~/.local/src/st
dunstrc_dir=~/.config/dunst

if [ -z "$1" ];then
	echo "Choosing a random wallpaper from your wallpaper directory..."
	wall="$(find "$wall_dir" -type f -name "*.jpg" -o -name "*.png" | shuf -n1)"
else
	wall="$1"
fi

convert $wall ~/.local/share/wallpaper/bg.jpg
convert -scale 10% -blur 0x2.5 -resize 1000% $wall ~/.local/share/wallpaper/lockscreen.png
convert -brightness-contrast -20x-5 ~/.local/share/wallpaper/lockscreen.png ~/.local/share/wallpaper/lockscreen.png
wal -i $wall

nitrogen --set-zoom-fill --save ~/.local/share/wallpaper/bg.jpg

sed -i -re '13,18d' ~/.cache/wal/colors-wal-dwm.h                              #to remove SchemeUrg color since I didn't get that patch
cp ~/.cache/wal/colors-wal-dwm.h $dwm_dir/dwm-colors.h
cp ~/.cache/wal/colors-wal-dmenu.h $dmenu_dir/dmenu-colors.h
cp ~/.cache/wal/colors-wal-st.h $st_dir/st-colors.h

rofi_bg=$(cat ~/.cache/wal/colors.hs | grep 'background' | grep -o '#......')
rofi_fg=$(cat ~/.cache/wal/colors.hs | grep 'color1=' | grep -o '#......')

dunst_bg=$(cat ~/.cache/wal/colors.sh | sed -n '6p' | grep -Po "\#......")
dunst_fg=$(cat ~/.cache/wal/colors.sh | sed -n '7p' | grep -Po "\#......")

sed -ir "s/frame_color = .*/frame_color = \"$rofi_fg\"/g" $dunstrc_dir/dunstrc
sed -ir "s/highlight = .*/highlight = \"$rofi_fg\"/g" $dunstrc_dir/dunstrc
sed -ir "s/background = .*/background = \"$dunst_bg\"/g" $dunstrc_dir/dunstrc
sed -ir "s/foreground = .*/foreground = \"$dunst_fg\"/g" $dunstrc_dir/dunstrc

sed -ir "s/background.*/background: $rofi_bg/g" ~/.config/rofi/theme.rasi
sed -ir "s/foreground.*/foreground: $rofi_fg/g" ~/.config/rofi/theme.rasi
sed -ir "s/searchbarbg.*/searchbarbg: $rofi_bg/g" ~/.config/rofi/theme.rasi

sed -ir "s/Sxiv.foreground.*/Sxiv.foreground: $rofi_fg/g" ~/.Xresources

sudo make clean -C $dwm_dir install
sudo make clean -C $dmenu_dir install
sudo make clean -C $st_dir install

pkill dunst
dunst >/dev/null 2>&1 < /dev/null & 

xrdb -load ~/.Xresources

xdotool key Control+F5
notify-send -t 3000 "îˆ« Color Scheme" "<span font = 'JetBrainsMono Nerd Font 11'>Changed color scheme</span>"

